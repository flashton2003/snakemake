todo_list = ['14742-WTCHG_689876_70145086', '14732-WTCHG_689876_70045076', '14877-WTCHG_689876_71495125', '14852-WTCHG_689876_71245100', '14870-WTCHG_689876_71425118', '14878-WTCHG_689876_71505126', '14879-WTCHG_689876_71515127', '14947-WTCHG_689876_72195195', '14880-WTCHG_689876_71525128', '14910-WTCHG_689876_71825158', '14810-WTCHG_689876_70825058', '15001-WTCHG_689876_72735249', '14948-WTCHG_689876_72205196', '14949-WTCHG_689876_72215197', '14925-WTCHG_689876_71975269', '14950-WTCHG_689876_72225198', '14861-WTCHG_689876_71335109', '15004-WTCHG_689876_72765252', '15005-WTCHG_689876_72775253', '15006-WTCHG_689876_72785254', '15007-WTCHG_689876_72795255', '15009-WTCHG_689876_72825258', '14833-WTCHG_689876_71055177', '14951-WTCHG_689876_72235199', '14743-WTCHG_689876_70155087', '14881-WTCHG_689876_71535129', '14911-WTCHG_689876_71835159', '14882-WTCHG_689876_71545130', '15011-WTCHG_689876_72845260', '15012-WTCHG_689876_72855261', '14952-WTCHG_689876_72245200', '14953-WTCHG_689876_72255201', '14926-WTCHG_689876_71985270', '14744-WTCHG_689876_70165088', '14912-WTCHG_689876_71845160', '14883-WTCHG_689876_71555131', '15014-WTCHG_689876_72875263', '14927-WTCHG_689876_71995271', '14954-WTCHG_689876_72265202', '15015-WTCHG_689876_72885264', '14834-WTCHG_689876_71065178', '14884-WTCHG_689876_71565132', '14753-WTCHG_689876_70255001', '14955-WTCHG_689876_72275203', '14862-WTCHG_689876_71345110', '14914-WTCHG_689876_71865162', '14915-WTCHG_689876_71875163', '14921-WTCHG_689876_71935265', '14863-WTCHG_689876_71355111', '14885-WTCHG_689876_71575133', '14956-WTCHG_689876_72285204', '14957-WTCHG_689876_72295205', '14835-WTCHG_689876_71075179', '14886-WTCHG_689876_71585134', '14958-WTCHG_689876_72305206', '14922-WTCHG_689876_71945266', '14836-WTCHG_689876_71085180', '14887-WTCHG_689876_71595135', '14864-WTCHG_689876_71365112', '14871-WTCHG_689876_71435119', '14959-WTCHG_689876_72315207', '14811-WTCHG_689876_70835059', '14960-WTCHG_689876_72325208', '14923-WTCHG_689876_71955267', '14888-WTCHG_689876_71605136', '14916-WTCHG_689876_71885164', '14889-WTCHG_689876_71615137', '14853-WTCHG_689876_71255101', '14795-WTCHG_689876_70675043', '14924-WTCHG_689876_71965268', '14734-WTCHG_689876_70065078', '14890-WTCHG_689876_71625138', '14891-WTCHG_689876_71635139', '14865-WTCHG_689876_71375113', '14866-WTCHG_689876_71385114', '14892-WTCHG_689876_71645140', '14754-WTCHG_689876_70265002', '14735-WTCHG_689876_70075079', '14893-WTCHG_689876_71655141', '14894-WTCHG_689876_71665142', '14895-WTCHG_689876_71675143', '14896-WTCHG_689876_71685144', '14872-WTCHG_689876_71445120', '14745-WTCHG_689876_70175089', '14733-WTCHG_689876_70055077', '14913-WTCHG_689876_71855161']

root_dir = '/home/ubuntu/external_tb/oucru_robot'

## first rule that runs, checks everything has finished
## somehow (?) propagates todo_list up the DAG
rule all:
    input:
        expand('{root_dir}/{sample}/tb_profiler/results/{sample}.full_profile.results.json', root_dir = root_dir, sample = todo_list)
        #expand('{sample}.json', sample = todo_list)

## sample comes from rule all
## in shell, need to use wildcards.sample instead of sample
## wildcards is the thing in the {} in input and output (?)
rule tb_profiler:
    input:
        r1 = '/home/ubuntu/external_tb/oucru_robot/{sample}/{sample}_bbduk_1.fastq.gz',
        r2 = '/home/ubuntu/external_tb/oucru_robot/{sample}/{sample}_bbduk_2.fastq.gz'
    output:
        '/home/ubuntu/external_tb/oucru_robot/{sample}/tb_profiler/results/{sample}.full_profile.results.json'
    #conda:
    #    '../../envs/tb_profiler.yaml'
    threads: 8
    shell:
        'tb-profiler profile -1 {input.r1} -2 {input.r2} -p {wildcards.sample}.full_profile -t {threads} --no_trim -d /home/ubuntu/external_tb/oucru_robot/{wildcards.sample}/tb_profiler/ --txt --csv'


