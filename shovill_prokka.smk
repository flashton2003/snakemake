root_dir = '/home/ubuntu/tm_data/ssuis_chickens/oucru_robot'
# todo_list = ['15335-0014', '15336-0224', '15337-02811', '15338-02821', '15339-02824', '15340-02831', '15341-0283', '15342-02911', '15343-02913', '15344-02914', '15345-02921', '15346-02922', '15347-02925', '15348-02931', '15349-02933', '15350-02941', '15351-02944', '15352-0294', '15353-02951', '15354-02953', '15355-0336', '15356-0413', '15357-0414', '15358-0442', '15359-0451', '15360-0482', '15361-0582', '15362-0704', '15363-0864', '15364-0873', '15365-0914', '15366-0943', '15367-09511', '15368-09512', '15369-09521', '15370-09523', '15371-09531', '15372-0953', '15373-09541', '15374-09551', '15375-09553', '15376-10211', '15377-10221', '15378-10223', '15379-1022', '15380-10231', '15381-10234', '15382-10241', '15383-10251', '15384-10311', '15385-10313', '15386-10322', '15387-10323', '15388-10333', '15389-1033', '15390-10341', '15391-10342', '15392-10352', '15393-1081', '15394-ERR047092', '15395-ERR120017', '15396-ERR120018', '15397-ERR120019', '15398-ERR120020', '15399-ERR120021', '15400-ERR120022', '15401-ERR120024', '15402-ERR120025', '15403-ERR120026', '15404-ERR120027', '15405-ERR120028', '15406-ERR120029', '15407-ERR120030', '15408-ERR120031', '15409-ERR120032', '15410-ERR120033', '15411-ERR120034', '15412-ERR120035', '15413-ERR120036', '15414-ERR120037', '15415-ERR120038', '15416-ERR120040', '15417-ERR120041', '15418-ERR120042', '15419-ERR120043', '15420-ERR120044', '15421-ERR120045', '15422-ERR120046', '15423-ERR120047', '15424-ERR120048', '15425-ERR120049', '15426-ERR120050', '15427-ERR120051', '15428-ERR120052', '15429-ERR120053', '15430-ERR120054', '15431-ERR120055', '15432-ERR120056', '15433-ERR120057', '15434-ERR120058', '15435-ERR120059', '15436-ERR120060', '15437-ERR120061', '15438-ERR120062', '15439-ERR120063', '15440-ERR120064', '15441-ERR120065', '15442-ERR120066', '15443-ERR120067', '15444-ERR120068', '15445-ERR120069', '15446-ERR120071', '15447-ERR120074', '15448-ERR120075', '15449-ERR120076', '15450-ERR120077', '15451-ERR120078', '15452-ERR120079', '15453-ERR120080', '15454-ERR120081', '15455-ERR120082', '15456-ERR120083', '15457-ERR120084', '15458-ERR120085', '15459-ERR120086', '15460-ERR120087', '15461-ERR120088', '15462-ERR120089', '15463-ERR120090', '15464-ERR120091', '15465-ERR120092', '15466-ERR120093', '15467-ERR120094', '15468-ERR120095', '15469-ERR120096', '15470-ERR120097', '15471-ERR120098', '15472-ERR120099', '15473-ERR120100', '15474-ERR120101', '15475-ERR120102', '15476-ERR120103', '15477-ERR120104', '15478-ERR120105', '15479-ERR120107', '15480-ERR120108', '15481-ERR120109', '15482-ERR120110', '15483-ERR120111', '15484-ERR120112', '15485-ERR120113', '15486-ERR120114', '15487-ERR120115', '15488-ERR120116', '15489-ERR120117', '15490-ERR120118', '15491-ERR120119', '15492-ERR120120', '15493-ERR120121', '15494-ERR120122', '15495-ERR120123', '15496-ERR120124', '15497-ERR120125', '15498-ERR120128', '15499-ERR120129', '15500-ERR120130', '15501-ERR120131', '15502-ERR120132', '15503-ERR120133', '15504-ERR120134', '15505-ERR120138', '15506-ERR120140', '15507-ERR120141', '15508-ERR120142', '15509-ERR120143', '15510-ERR120144', '15511-ERR120145', '15512-ERR120146', '15513-ERR120147', '15514-ERR120148', '15515-ERR120149', '15516-ERR120150', '15517-ERR120151', '15518-ERR120152', '15519-ERR120153', '15520-ERR120154', '15521-ERR120155', '15522-ERR120156', '15523-ERR120157', '15524-ERR120158', '15525-ERR120159', '15526-ERR120160', '15527-ERR120161', '15528-ERR120162', '15529-ERR120164', '15530-ERR120167', '15531-ERR120168', '15532-ERR120169', '15533-ERR120170', '15534-ERR120171', '15535-ERR120172', '15536-ERR120173', '15537-ERR120174', '15538-ERR120175', '15539-ERR120176', '15540-ERR120177', '15541-ERR120178', '15542-ERR120179', '15543-ERR120180', '15544-ERR120181', '15545-ERR120182', '15546-ERR120183', '15547-ERR120184', '15548-ERR120185', '15549-ERR120186', '15550-ERR120187', '15551-ERR120188', '15552-ERR120189', '15553-ERR120190', '15554-ERR120191', '15555-ERR120192', '15556-ERR120193', '15557-ERR120194', '15558-ERR120195', '15559-ERR120196', '15560-ERR120197', '15561-ERR120198', '15562-ERR120199', '15563-ERR120200', '15564-ERR120201', '15565-ERR120202', '15566-ERR120203', '15567-ERR120204', '15568-ERR120205', '15569-ERR120206', '15570-ERR120207', '15571-ERR120208', '15572-ERR120209', '15573-ERR120210', '15574-ERR120211', '15575-ERR120212', '15576-ERR120214', '15577-ERR120215', '15578-ERR120216', '15579-ERR193218', '15580-ERR193219', '15581-ERR193220', '15582-ERR193221', '15583-ERR193222', '15584-ERR193223', '15585-ERR193224', '15586-ERR193225', '15587-ERR193226', '15588-ERR193227', '15589-ERR193228', '15590-ERR193229', '15591-ERR193230', '15592-ERR193231', '15593-ERR193232', '15594-ERR193233', '15595-ERR193234', '15596-ERR193235', '15597-ERR193236', '15598-ERR193237', '15599-ERR193238', '15600-ERR193239', '15601-ERR193241', '15602-ERR193242', '15603-ERR193243', '15604-ERR193244', '15605-ERR193245', '15606-ERR193246', '15607-ERR193247', '15608-ERR193248', '15609-ERR193249', '15610-ERR193250', '15611-ERR193251', '15612-ERR193252', '15613-ERR193253', '15614-ERR193254', '15615-ERR193255', '15616-ERR193256', '15617-ERR193257', '15618-ERR193258', '15619-ERR193259', '15620-ERR193260', '15621-ERR193261', '15622-ERR193262', '15623-ERR193263', '15624-ERR193264', '15625-ERR193265', '15626-ERR193266', '15627-ERR193267', '15628-ERR193268', '15629-ERR193269', '15630-ERR193270', '15631-ERR193271', '15632-ERR193272', '15633-ERR193273', '15634-ERR193274', '15635-ERR193275', '15636-ERR193276', '15637-ERR193277', '15638-ERR193278', '15639-ERR193279', '15640-ERR193280', '15641-ERR193281', '15642-ERR193282', '15643-ERR193283', '15644-ERR193284', '15645-ERR193285', '15646-ERR193286', '15647-ERR193287', '15648-ERR193288', '15649-ERR193289', '15650-ERR193290', '15651-ERR193291', '15652-ERR193292', '15653-ERR193293', '15654-ERR193294', '15655-ERR193295', '15656-ERR193296', '15657-ERR193297', '15658-ERR193298', '15659-ERR193299', '15660-ERR193300', '15661-ERR193301', '15662-ERR193302', '15663-ERR193303', '15664-ERR193304', '15665-ERR193305', '15666-ERR193306', '15667-ERR193307', '15668-ERR193308', '15669-ERR193309', '15670-ERR193310', '15671-ERR193311', '15672-ERR193313', '15673-ERR211699', '15674-ERR211700', '15675-ERR211701', '15676-ERR211702', '15677-ERR211703', '15678-ERR211704', '15679-ERR211705', '15680-ERR211706', '15681-ERR211707', '15682-ERR211708', '15683-ERR211709', '15684-ERR211710', '15685-ERR211711', '15686-ERR211712', '15687-ERR211713', '15688-ERR211714', '15689-ERR211715', '15690-ERR211716', '15691-ERR211717', '15692-ERR211718', '15693-ERR211719', '15694-ERR211720', '15695-ERR211721', '15696-ERR211722', '15697-ERR211723', '15698-ERR211724', '15699-ERR211725', '15700-ERR211726', '15701-ERR211727', '15702-ERR211728', '15703-ERR211729', '15704-ERR211730', '15705-ERR211731', '15706-ERR211732', '15707-ERR211733', '15708-ERR211734', '15709-ERR211735', '15710-ERR211736', '15711-ERR211737', '15712-ERR211738', '15713-ERR211739', '15714-ERR211740', '15715-ERR211741', '15716-ERR211742', '15717-ERR211743', '15718-ERR211744', '15719-ERR211745', '15720-ERR211746', '15721-ERR211747', '15722-ERR211748', '15723-ERR211749', '15724-ERR211750', '15725-ERR211751', '15726-ERR211752', '15727-ERR211753', '15728-ERR211754', '15729-ERR211755', '15730-ERR211756', '15731-ERR211757', '15732-ERR211758', '15733-ERR211759', '15734-ERR211760', '15735-ERR211761', '15736-ERR211762', '15737-ERR211763', '15738-ERR211764', '15739-ERR211765', '15740-ERR211766', '15741-ERR211767', '15742-ERR211768', '15743-ERR211769', '15744-ERR211770', '15745-ERR211771', '15746-ERR211772', '15747-ERR211773', '15748-ERR211774', '15749-ERR211775', '15750-ERR211776', '15751-ERR211777', '15752-ERR211778', '15753-ERR211779', '15754-ERR211780', '15755-ERR211781', '15756-ERR211782', '15757-ERR211783', '15758-ERR211784', '15759-ERR211785', '15760-ERR211786', '15761-ERR211787', '15762-ERR211788', '15763-ERR211789', '15764-ERR211790', '15765-ERR211791', '15766-ERR211792', '15767-ERR211793', '15768-ERR211794']
todo_list = ['15335-0014']
assert os.path.exists(root_dir)

rule all:
    input:
        expand('{root_dir}/{sample}/prokka/{sample}.gbk', sample = todo_list, root_dir = root_dir)

rule shovill:
    params:
        threads = 8,
        ram = 32
    input:    
            r1 = '{root_dir}/{sample}/{sample}_bbduk_1.fastq.gz',
            r2 = '{root_dir}/{sample}/{sample}_bbduk_2.fastq.gz'
    output:
        final = '{root_dir}/{sample}/shovill_bbduk/contigs.fa',
        graph = '{root_dir}/{sample}/shovill_bbduk/contigs.gfa',
        spades = '{root_dir}/{sample}/shovill_bbduk/spades.fasta'
    shell:
        'shovill --outdir {root_dir}/{wildcards.sample}/shovill_bbduk -R1 {input.r1} -R2 {input.r2} --cpus {params.threads} --ram {params.ram} --force'

rule move_shovill_output:
    input:
        final = rules.shovill.output.final,
        graph = rules.shovill.output.graph,
        spades = rules.shovill.output.spades
    output:
        final = '{root_dir}/{sample}/shovill_bbduk/{sample}_contigs.fa',
        graph = '{root_dir}/{sample}/shovill_bbduk/{sample}_contigs.gfa',
        spades = '{root_dir}/{sample}/shovill_bbduk/{sample}_spades.fasta'

    shell:
        '''mv {input.final} {output.final}
        mv {input.graph} {output.graph}
        mv {input.spades} {output.spades}
        '''

rule prokka:
    input:
        move_shovill_output.output.final
    output:
        '{root_dir}/{sample}/prokka/{sample}.gbk'
    shell:
        'prokka --outdir {root_dir}/{wildcards.sample}/prokka --prefix {wildcards.sample} {input}'

