todo_list = ['12100-ERR983232', '12110-SRR5520557', '12123-SRR5520609', '12524-ERR2652914', '12525-ERR2652915', '12526-ERR2652916', '12528-ERR2652919', '12529-ERR2652920', '12535-ERR2652927', '12537-ERR2652929', '12539-ERR2652931', '12541-ERR2652933', '12544-ERR2652936', '12547-ERR2652939', '12548-ERR2652940', '12551-ERR2652943', '12552-ERR2652944', '12553-ERR2652945', '12554-ERR2652946', '12556-ERR2652948', '12557-ERR2652949', '12563-ERR2652955', '12564-ERR2652956', '12569-ERR2652961', '12572-ERR2652964', '12573-ERR2652965', '12575-ERR2652967', '12576-ERR2652968', '12577-ERR2652969', '12582-ERR2652974', '12583-ERR2652975', '12586-ERR2652978', '12588-ERR2652980', '12589-ERR2652981', '12591-ERR2652983', '12592-ERR2652984', '12593-ERR2652985', '12598-ERR2652990', '12600-ERR2652992', '12602-ERR2652994', '12604-ERR2652996', '12608-ERR2653000', '12609-ERR2653001', '12610-ERR2653002', '12613-ERR2653005', '12614-ERR2653006', '12616-ERR2653008', '12622-ERR2653014', '12624-ERR2653016', '12626-ERR2653018', '12629-ERR2653021', '12631-ERR2653023', '12633-ERR2653025', '12634-ERR2653026', '12635-ERR2653027', '12636-ERR2653028', '12638-ERR2653030', '12642-ERR2653034', '12648-ERR2653040', '12649-ERR2653041', '12650-ERR2653042', '12651-ERR2653043', '12653-ERR2653045', '12660-ERR2653052', '12662-ERR2653054', '12666-ERR2653058', '12669-ERR2653061', '12670-ERR2653062', '12671-ERR2653063', '12672-ERR2653064', '12673-ERR2653065', '12674-ERR2653066', '12676-ERR2653068', '12677-ERR2653069', '12679-ERR2653071', '12681-ERR2653073', '12682-ERR2653074', '12683-ERR2653075', '12684-ERR2653076', '12685-ERR2653077', '12686-ERR2653078', '12687-ERR2653079', '12689-ERR2653081', '12691-ERR2653083', '12693-ERR2653085', '12694-ERR2653086', '12695-ERR2653087', '12697-ERR2653089', '12698-ERR2653090', '12706-ERR2653098', '12707-ERR2653099', '12709-ERR2653101', '12713-ERR2653105', '12716-ERR2653108', '12720-ERR2653112', '12722-ERR2653114', '12724-ERR2653116', '12729-ERR2653121', '12735-ERR2653127', '12736-ERR2653128', '12737-ERR2653129', '12738-ERR2653130', '12741-ERR2653133', '12746-ERR2653138', '12747-ERR2653139', '12748-ERR2653140', '12749-ERR2653141', '12752-ERR2653144', '12755-ERR2653147', '12758-ERR2653150', '12767-ERR2653159', '12768-ERR2653160', '12770-ERR2653162', '12772-ERR2653164', '12782-ERR2653174', '12786-ERR2653178', '12788-ERR2653180', '12792-ERR2653184', '12795-ERR2653187', '12796-ERR2653188', '12797-ERR2653189', '12798-ERR2653190', '12799-ERR2653191', '12800-ERR2653192', '12802-ERR2653194', '12806-ERR2653198', '12808-ERR2653200', '12811-ERR2653203', '12812-ERR2653204', '12814-ERR2653206', '12816-ERR2653208', '12818-ERR2653210', '12819-ERR2653211', '12820-ERR2653212', '12821-ERR2653213', '12823-ERR2653215', '12824-ERR2653216', '12826-ERR2653218', '12827-ERR2653219', '12828-ERR2653220', '12829-ERR2653221', '12830-ERR2653222', '12832-ERR2653224', '12833-ERR2653225', '12834-ERR2653226', '12835-ERR2653227', '12840-ERR2653232', '12841-ERR2653233', '12843-ERR2653235', '12846-ERR2653238', '12847-ERR2653239', '12848-ERR2653240', '12851-ERR023729', '12852-ERR023731', '12853-ERR023732', '12854-ERR023737', '12855-ERR023738', '12856-ERR023739', '12857-ERR023740', '12859-ERR023747', '12860-ERR023757', '12861-ERR023758', '12862-ERR023759', '12863-ERR023760', '12865-ERR023764', '12866-ERR024340', '12867-ERR024343', '12868-ERR024344', '12869-ERR024345', '12870-ERR024346', '12871-ERR024347', '12872-ERR024355', '12873-ERR024359', '12874-ERR025414', '12875-ERR025415', '12876-ERR025416', '12877-ERR025417', '12878-ERR025418', '12879-ERR025419', '12880-ERR025420', '12881-ERR025421', '12882-ERR025422', '12883-ERR025423', '12884-ERR025424', '12885-ERR025426', '12886-ERR025427', '12887-ERR025428', '12888-ERR025429', '12889-ERR025430', '12890-ERR025431', '12891-ERR025432', '12892-ERR025433', '12893-ERR025434', '12894-ERR025435', '12895-ERR025436', '12896-ERR025438', '12897-ERR025440', '12899-ERR025450', '12900-ERR025451', '12901-ERR025452', '12902-ERR025453', '12903-ERR025454', '12904-ERR025455', '12905-ERR025456', '12906-ERR025457', '12907-ERR025458', '12908-ERR025459', '12909-ERR025460', '12910-ERR026472', '12911-ERR026475', '12912-ERR026476', '12913-ERR028608', '12915-ERR028612', '12916-ERR028613', '12917-ERR028615', '12918-ERR028616', '12919-ERR028617', '12920-ERR028620', '12921-ERR028621', '12922-ERR028622', '12923-ERR028624', '12924-ERR028625', '12925-ERR028626', '12926-ERR028628', '12927-ERR028629', '12928-ERR029201', '12929-ERR029202', '12930-ERR029204', '12931-ERR029211', '12932-ERR257880', '12933-ERR257886', '12934-ERR257891', '12935-ERR257892', '12936-ERR257893', '12937-ERR257894', '12938-ERR257895', '12939-ERR257896', '12940-ERR257897', '12941-ERR257898', '12942-ERR257899', '12943-ERR257900', '12944-ERR257901', '12945-ERR257902', '12946-ERR257903', '12947-ERR257904', '12948-ERR257905', '12949-ERR257906', '12950-ERR257907', '12951-ERR257908', '12952-ERR257909', '12953-ERR257910', '12954-ERR257911', '12955-ERR257912', '12956-ERR257915', '12957-ERR257917', '12958-ERR257931', '12960-ERR257933', '12961-ERR257934', '12962-ERR257935', '11278-ERR234152', '11280-ERR234154', '11287-ERR234161', '11297-ERR234171', '11299-ERR234173', '11300-ERR234174', '11301-ERR234175', '11313-ERR234187', '11324-ERR234198', '11326-ERR234200', '11329-ERR234203', '11332-ERR234206', '11338-ERR234212', '11352-ERR234239', '11357-ERR234244', '11364-ERR234251', '11371-ERR234258', '11372-ERR234259', '11373-ERR234260', '11378-ERR234265', '11381-ERR234268', '10574-SRR5709740', '10577-SRR5709743', '10614-SRR5709781', '10654-SRR5709821', '10679-SRR5709846', '10794-SRR5709969', '10797-SRR5709972', '10835-SRR5710013', '10839-SRR5710017', '10841-SRR5710019', '12210-ERR2179684', '12211-ERR2179685', '12212-ERR2179686', '12215-ERR2179689', '12216-ERR2179690', '12219-ERR2179693', '12220-ERR2179694', '12221-ERR2179695', '12223-ERR2179697', '12226-ERR2179700', '12227-ERR2179701', '12237-ERR2179712', '12239-ERR2179714', '12241-ERR2179716', '12242-ERR2179717', '12245-ERR2179721', '12249-ERR2179725', '12253-ERR2179729', '12256-ERR2179732', '12258-ERR2179734', '12261-ERR2179737', '12262-ERR2179738', '12264-ERR2179740', '12265-ERR2179741', '12266-ERR2179742', '12268-ERR2179744', '12269-ERR2179745', '12272-ERR2179748', '12273-ERR2179749', '12274-ERR2179750', '12277-ERR2179753', '12280-ERR2179756', '12281-ERR2179757', '12284-ERR2179760', '12294-ERR2179770', '12299-ERR2179775', '12302-ERR2179778', '12306-ERR2179782', '12307-ERR2179783', '12308-ERR2179784', '12314-ERR2179790', '12315-ERR2179791', '12316-ERR2179792', '12318-ERR2179794', '12324-ERR2179800', '12326-ERR2179802', '12329-ERR2179805', '12333-ERR2179809', '12335-ERR2179811', '12337-ERR2179813', '12340-ERR2179833', '12342-ERR2179835', '12344-ERR2179837', '12345-ERR2179838', '12352-ERR2179845', '12353-ERR2179846', '12355-ERR2179848', '12356-ERR2179849', '12362-ERR2179855', '12369-ERR2179862', '11170-SRR6480625', '11172-SRR6480627', '10860-SRR6480315', '10864-SRR6480319', '10866-SRR6480321', '10868-SRR6480323', '11173-SRR6480628', '11175-SRR6480630', '11178-SRR6480633', '10869-SRR6480324', '10880-SRR6480335', '10883-SRR6480338', '10884-SRR6480339', '10885-SRR6480340', '10888-SRR6480343', '10894-SRR6480349', '10900-SRR6480355', '10907-SRR6480362', '10908-SRR6480363', '10924-SRR6480379', '10932-SRR6480387', '10935-SRR6480390', '10936-SRR6480391', '10937-SRR6480392', '10938-SRR6480393', '10944-SRR6480399', '10945-SRR6480400', '10947-SRR6480402', '10957-SRR6480412', '10958-SRR6480413', '10960-SRR6480415', '10963-SRR6480418', '10964-SRR6480419', '10967-SRR6480422', '10974-SRR6480429', '10975-SRR6480430', '10982-SRR6480437', '10984-SRR6480439', '10990-SRR6480445', '10991-SRR6480446', '10992-SRR6480447', '10996-SRR6480451', '11000-SRR6480455', '11001-SRR6480456', '11008-SRR6480463', '11014-SRR6480469', '11015-SRR6480470', '11016-SRR6480471', '11020-SRR6480475', '11023-SRR6480478', '11030-SRR6480485', '11035-SRR6480490', '11040-SRR6480495', '11043-SRR6480498', '11045-SRR6480500', '11048-SRR6480503', '11050-SRR6480505', '11057-SRR6480512', '11060-SRR6480515', '11061-SRR6480516', '11068-SRR6480523', '11073-SRR6480528', '11075-SRR6480530', '11081-SRR6480536', '11083-SRR6480538', '11096-SRR6480551', '11104-SRR6480559', '11107-SRR6480562', '11108-SRR6480563', '11109-SRR6480564', '11112-SRR6480567', '11117-SRR6480572', '11122-SRR6480577', '11123-SRR6480578', '11126-SRR6480581', '11130-SRR6480585', '11132-SRR6480587', '11135-SRR6480590', '11140-SRR6480595', '11141-SRR6480596', '11143-SRR6480598', '11144-SRR6480599', '11149-SRR6480604', '11154-SRR6480609', '11155-SRR6480610', '11160-SRR6480615', '11163-SRR6480618', '11166-SRR6480621', '11944-SRR671740', '11968-SRR671764', '11972-SRR671768', '11976-SRR671772', '11977-SRR671773', '11979-SRR671775', '12035-SRR671831', '12036-SRR671832', '12042-SRR671838', '12063-SRR671859', '12065-SRR671861', '12072-SRR671868', '12078-SRR671874', '12082-SRR671878']
## something about tb_profiler and move_output rules are ambiguous, so have to specify rule order
ruleorder: tb_profiler > move_output

## first rule that runs, checks everything has finished
## somehow (?) propagates todo_list up the DAG
rule all:
    input:
        expand('/home/ubuntu/external_tb/oucru_robot/{sample}/tb_profiler/{sample}.json', sample = todo_list)
        #expand('{sample}.json', sample = todo_list)

## sample comes from rule all
## in shell, need to use wildcards.sample instead of sample
## wildcards is the thing in the {} in input and output (?)
rule tb_profiler:
    input:
        bam = '/home/ubuntu/external_tb/oucru_robot/{sample}/phenix_bbduk/{sample}.bam'
    output:
        '{sample}.json'
    #group:
    #    'run_n_move'
    shell:
        'tb-profiler lineage -a {input.bam} -p {wildcards.sample}'


rule move_output:
    input:
        '{sample}.json'
    output:
        '/home/ubuntu/external_tb/oucru_robot/{sample}/tb_profiler/{sample}.json'
    #group:
    #    'run_n_move'
    shell:
        'mv {wildcards.sample}.json /home/ubuntu/external_tb/oucru_robot/{wildcards.sample}/tb_profiler/{wildcards.sample}.json'
